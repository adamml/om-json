{
	"$schema":"http://json-schema.org/schema#",
	"id":"http://waterml2.csiro.au/om-json/observation.json",
	"title":"Observation",
	"description":"An observation is an act associated with a discrete time instant or period through which a number, term or other symbol is assigned to a phenomenon. It involves application of a specified procedure, such as a sensor, instrument, algorithm or process chain. The procedure may be applied in-situ, remotely, or ex-situ with respect to the sampling location. The result of an observation is an estimate of the value of a property of some feature. Use of a common model allows observation data using different procedures to be combined unambiguously. The observation itself is also a feature, since it has properties and identity. Observation details are important for data discovery and for data quality estimation. The observation could be considered to carry âproperty-levelâ instance metadata, which complements the dataset-level and feature-level metadata that have been conventionally considered (e.g. ISO 19115)",
	"type":"object",
  "required" : ["phenomenonTime", "observedProperty", "procedure", "featureOfInterest", "resultTime"],
  "definitions" : {
    "dateTimePeriod" : {
      "title": "dateTimePeriod",
      "type": "object",
      "required" : ["begin", "end"],
      "properties": {
        "begin" : { "type": "string", "format" : "date-time" },
        "end" : { "type": "string", "format" : "date-time" }
      }
    },
    "dateTimeInstant" : {
      "title": "dateTimeInstant",
      "type": "object",
      "required": ["instant"],
      "properties": {
        "instant" : { "type": "string", "format" : "date-time" }
      }
    },
      "measureResult": {
        "title" : "measureResult", 
        "type" : "object",
        "required": ["value", "uom"],
        "properties" : {
          "value" : { "type" : "number" },
          "uom" : { "type" : "string" }
        }
      },
      "link": {
        "title" : "link", 
        "type" : "object",
        "required": ["href"],
        "properties" : {
          "href" : { "type" : "string", "format":"uri" },
          "rel" : { "type" : "string", "format":"uri" },
          "title" : { "type" : "string" }
        }
      },
      "linkOrObject": {
        "title" : "linkOrObject", 
        "type" : "object",
			  "oneOf": [ { "$ref": "#/definitions/link" }, { "type": "object"} ]
      },
      "booleanResult": {
        "title" : "booleanResult", 
        "type" : "object",
        "required": ["value"],
        "properties" : {
          "value" : { "type" : "boolean" }
        }
      },
      "temporalResult": {
        "title" : "temporalResult", 
        "type" : "object",
			  "oneOf": [ { "$ref": "#/definitions/dateTimePeriod" }, { "$ref" : "#/definitions/dateTimeInstant" } ]
      },
      "countResult": {
        "title" : "countResult", 
        "type" : "object",
        "properties" : {
          "value" : { "type" : "integer" }
        }
      },
      "geometryResult": {
        "title" : "geometryResult", 
        "type" : "object",
			  "oneOf": [ { "$ref": "https://gist.githubusercontent.com/peterataylor/47bcd797e0ef3ac92341/raw/fb6e7428791e9afa6c8c05c5be1f5a20c8e043c1/geometry.json" } ]
      }
  },
	"properties":{
				"phenomenonTime":{
					"title":"phenomenonTime",
					"description":"Time at which the estimate of the property that is the result of the observation is associated with the feature of interest",
					"type":"object",
					"oneOf": [ { "$ref": "#/definitions/dateTimePeriod" }, { "$ref" : "#/definitions/dateTimeInstant" } ]
				},
				"observedProperty":{
					"title":"observedProperty",
					"description":"property whose value is the result of the observation",
          "$ref": "#/definitions/link"
				},
				"procedure":{
          "$ref": "#/definitions/link",
					"title":"procedure",
					"description":"procedure used in making observation. Typically a sensor or sensor-system, algorithm, computational procedure."
				},
				"featureOfInterest":{
          "$ref": "#/definitions/linkOrObject",
					"title":"featureOfInterest",
					"description":"time at which the result became available, after all processing steps were completed"
				},
				"type":{
					"title":"type",
					"description":"Identifies the type of observation, which determines the type of the result property",
					"type":"string",
					"format":"uri"
				},
				"resultTime":{
					"title":"phenomenonTime",
					"description":"Time at which the estimate of the property that is the result of the observation is associated with the feature of interest",
					"type":"string",
					"format":"date-time"
				},
				"relatedObservation":{
					"title":"relatedObservation",
					"description":"links to related observations",
					"type":"object",
					"properties": { 
            "role" : { "type" : "string", "format":"uri" },
            "relatedObservation" : { "type" : "string", "format":"uri" }
          }
				},
        "result" : {
          "title": "result",
          "description": "result of the observation",
          "type": "object",
          "oneOf": [ { "$ref":"#/definitions/measureResult" }, 
                     { "$ref":"#/definitions/booleanResult"  },
                     { "$ref":"#/definitions/countResult"  },
                     { "$ref":"#/definitions/geometryResult"  },
                     { "$ref":"#/definitions/temporalResult"} ]
        }
     }
}
